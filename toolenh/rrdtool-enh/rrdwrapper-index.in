#!/bin/bash
    RCSID='$Id: - @VERSION@ @DATE@ @TIME@ - $'
    PROGRAM_TITLE="Round Robin Graphics Index"
    PROGRAM_SYNTAX="[OPTIONS] [--] ..."

    . shlib-import cliboot
    option -q --quiet       "Repeat to get less info"
    option -v --verbose     "Repeat to get more info"
    option -h --help        "Show this help page"
    option    --version     "Print the version info"

    shopt -s nullglob

function setopt() {
    case "$1" in
        -h|--help)
            help; exit;;
        -q|--quiet)
            LOGLEVEL=$((LOGLEVEL - 1));;
        -v|--verbose)
            LOGLEVEL=$((LOGLEVEL + 1));;
        --version)
            version; exit;;
        *)
            quit "invalid option: $1";;
    esac
}

function main() {
    _main "$@"
}

function _main() {
    echo "Content-Type: text/html"
    echo

    dir="${SCRIPT_FILENAME%/*}"
    count=0

    echo "<html>"
    echo "<head>"
    echo "<title>$TITLE</title>"
    echo "</head>"
    echo "<body>"

    echo "<h1>$TITLE</h1>"
    echo "<hr>"

    files=("$dir"/*.rrw)
    if [ ${#files[@]} = 0 ]; then
        echo "No round robin graphic available yet."
    else
        echo "<ul>"
        for file in "${files[@]}"; do
            name="${file##*/}"
            name="${name%.rrw}"
            echo "<li>$name: "
                read _tag _title < <("$file" --version)
                echo "$_title"
            echo "</li>"
        done
        echo "</ul>"
    fi

    echo "<hr>"
    echo "<cite>Generated by: "; version; echo "</cite>"
}

boot "$@"
