# vim: set filetype=sh :

function load-image() {
    local caller="${BASH_SOURCE[1]}"
    if [ "${caller:0:5}" = '/dev/' ]; then
        if [ -f "$AI_SOURCE" ]; then
            caller="$AI_SOURCE"
        fi
    fi

    local img="${caller%.in}.img"

    local dir="${img%/*}"
    local base="${img##*/}"
    if [ "$dir" = "$img" ]; then
        dir=.
        base="$img"
    fi

    if [ -f "$dir/.$base" ]; then
        img="$dir/.$base"
    fi

    .. "$img"
}
