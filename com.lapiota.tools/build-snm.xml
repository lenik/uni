<?xml version="1.0"?>
<project name="net.bodz.lapiota" default="default">

    <property environment="env" />
    <import file="${env.LAPIOTA}/lib/ant/basic.xml" />

    <target name="default" depends="10bin.jar, 10src.jar, 20mkbat, .kala.dist" />

    <target name="00update-lib">
        <copy todir="${basedir}/lib">
            <fileset dir="${JAVA_LIB}">
                <include name="${lib.apc_collections}" />
                <include name="${lib.dom4j}" />
                <include name="${lib.groovy}" />
                <include name="${lib.jaxen}" />
                <include name="${lib.jawin}" />
            </fileset>
            <fileset dir="${java.home}/lib">
                <include name="deploy.jar" />
            </fileset>
        </copy>
    </target>

    <target name="10bin.jar">
        <mkdir dir="build" />
        <jar destfile="build/net.bodz.lapiota.jar" update="true">
            <fileset dir="mod/CLI Utilities/bin" />
            <fileset dir="mod/Commons/bin" />
            <fileset dir="mod/GUI Utilities/bin" />
            <fileset dir="mod/Java Tools/bin" />
            <fileset dir="mod/SNM C Framework/bin" />
        </jar>
        <!--
		<jar destfile="build/test.jar" update="true">
			<fileset dir="mod/CLI Utilities/test.bin" />
			<fileset dir="mod/Commons/test.bin" />
			<fileset dir="mod/GUI Utilities/test.bin" />
			<fileset dir="mod/Java Tools/test.bin" />
			<fileset dir="mod/SNM C Framework/test.bin" />
		</jar>
		-->
        <length property="size.bin" file="lib/net.bodz.lapiota.jar" />
        <echo>Size: ${size.bin}</echo>
    </target>

    <target name="10src.jar">
        <mkdir dir="build" />
        <jar destfile="build/net.bodz.lapiota-src.jar" update="true">
            <fileset dir="mod/CLI Utilities/src" />
            <fileset dir="mod/Commons/src" />
            <fileset dir="mod/GUI Utilities/src" />
            <fileset dir="mod/Java Tools/src" />
            <fileset dir="mod/SNM C Framework/src" />
        </jar>
        <length property="size.src" file="lib/net.bodz.lapiota-src.jar" />
        <echo>Size: ${size.src}</echo>
    </target>

    <target name="20mkbat">
        <mkbat outdir="${basedir}/bin">
            <library>bodz_lapiota</library>
            <classpath refid="project.classpath" />
            <classpath>
                <fileset dir="${JAVA_LIB}">
                    <include name="${lib.bodz_swt}" />
                </fileset>
            </classpath>
            <findmain path="mod/CLI Utilities/bin" />
            <findmain path="mod/GUI Utilities/bin" />
            <findmain path="mod/Java Tools/bin" />
            <findmain path="mod/SNM C Framework/bin" />
        </mkbat>

        <mkbat outdir="${basedir}/test.bin">
            <library>bodz_lapiota</library>
            <classpath refid="project.classpathWithTest" />
            <classpath>
                <fileset dir="${JAVA_LIB}">
                    <include name="${lib.bodz_swt}" />
                </fileset>
            </classpath>
            <findmain path="mod/CLI Utilities/test.bin" />
            <findmain path="mod/GUI Utilities/test.bin" />
            <findmain path="mod/Java Tools/test.bin" />
            <findmain path="mod/SNM C Framework/test.bin" />
        </mkbat>
    </target>

</project>
