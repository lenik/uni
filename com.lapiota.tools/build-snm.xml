<?xml version="1.0"?>
<project name="net.bodz.lapiota" default="default">

	<property environment="env" />
	<property name="JAVA_LIB" value="${env.JAVA_LIB}" />
	<property file="${JAVA_LIB}/libraries.ini" prefix="lib" />

	<property name="distdir" value="${env.JAVA_LIB}" />
	<property name="distsrc" value="${env.JAVA_SRC}" />

	<target name="default" depends="dist, :bat" />

	<target name="dist" depends=":bin.jar, :src.jar">
		<copy todir="${distdir}" file="${basedir}/build/net.bodz.lapiota.jar" />
		<copy todir="${distsrc}" file="${basedir}/build/net.bodz.lapiota-src.jar" />
	</target>

	<path id="bins">
		<path path="mod/Build Tools/bin" />
		<path path="mod/CLI Utilities/bin" />
		<path path="mod/Commons/bin" />
		<path path="mod/GUI Utilities/bin" />
		<path path="mod/Java Tools/bin" />
		<path path="mod/SNM C Framework/bin" />
	</path>

	<path id="testbins">
		<path path="mod/Build Tools/test.bin" />
		<path path="mod/CLI Utilities/test.bin" />
		<path path="mod/Commons/test.bin" />
		<path path="mod/GUI Utilities/test.bin" />
		<path path="mod/Java Tools/test.bin" />
		<path path="mod/SNM C Framework/test.bin" />
	</path>

	<target name=":bin.jar">
		<mkdir dir="build" />
		<jar destfile="build/net.bodz.lapiota.jar" update="true">
			<fileset dir="mod/CLI Utilities/bin" />
			<fileset dir="mod/Commons/bin" />
			<fileset dir="mod/GUI Utilities/bin" />
			<fileset dir="mod/Java Tools/bin" />
			<fileset dir="mod/SNM C Framework/bin" />
		</jar>
		<!--
		<jar destfile="build/test.jar" update="true">
			<fileset dir="mod/CLI Utilities/test.bin" />
			<fileset dir="mod/Commons/test.bin" />
			<fileset dir="mod/GUI Utilities/test.bin" />
			<fileset dir="mod/Java Tools/test.bin" />
			<fileset dir="mod/SNM C Framework/test.bin" />
		</jar>
		-->
	</target>

	<target name=":src.jar">
		<mkdir dir="build" />
		<jar destfile="build/net.bodz.lapiota-src.jar" update="true">
			<fileset dir="mod/CLI Utilities/src" />
			<fileset dir="mod/Commons/src" />
			<fileset dir="mod/GUI Utilities/src" />
			<fileset dir="mod/Java Tools/src" />
			<fileset dir="mod/SNM C Framework/src" />
		</jar>
	</target>

	<target name=":bat">
		<taskdef name="mkbat" classname="net.bodz.bas.cli.util.MkbatTask">
			<classpath>
				<fileset dir="${JAVA_LIB}">
					<include name="${lib.bodz_bas}" />
					<include name="${lib.dom4j}" />
					<include name="${lib.groovy}" />
				</fileset>
			</classpath>
		</taskdef>

		<mkbat outdir="${env.LAPIOTA}/bin/w">
			<userlibs refid="bins" />
			<userlibs>
				<fileset dir="${JAVA_LIB}">
					<include name="${lib.bodz_swt}" />
				</fileset>
			</userlibs>
			<srcdir path="mod/CLI Utilities/bin" />
			<srcdir path="mod/GUI Utilities/bin" />
			<srcdir path="mod/Java Tools/bin" />
			<srcdir path="mod/SNM C Framework/bin" />
		</mkbat>

		<mkbat outdir="${basedir}/build/bin">
			<userlibs refid="bins" />
			<userlibs refid="testbins" />
			<userlibs>
				<fileset dir="${JAVA_LIB}">
					<include name="${lib.bodz_swt}" />
				</fileset>
			</userlibs>
			<srcdir path="mod/CLI Utilities/test.bin" />
			<srcdir path="mod/GUI Utilities/test.bin" />
			<srcdir path="mod/Java Tools/test.bin" />
			<srcdir path="mod/SNM C Framework/test.bin" />
		</mkbat>
	</target>

	<target name="clean">
		<delete verbose="true">
			<fileset dir="${basedir}/build" includes="*.jar" />
		</delete>
	</target>

</project>
