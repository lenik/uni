#!/usr/bin/perl

use strict;
use POSIX qw/strftime/;
use cmt::gene;
use cmt::vcs;
use Getopt::Long;

my %id = parse_id('$Id: dnac,v 1.2 2005-03-03 03:27:59 dansei Exp $');
my $now = strftime "%Y-%m-%d %H:%M:%S", localtime;


    our $opt_indent = 4;

    GetOptions(
        'indent=n',
        'help'      => sub { &help },
        );


    print <<"HDR";
use strict;
use cmt::gene;
    DNA<<DNA;

# The DNA is generated by DNA-Compiler $id{rev}
# Date $now

HDR

    my $indent = "\t"x$opt_indent;

    while (<>) {
	my @line = Encode($_);
	my $lastline = $line[scalar(@line) - 1];
	my ($pad, $len) = $lastline =~ m/^(\s*).(-*)/;
	foreach (@line) {
	    print "$indent$_";
	}
	$pad = length($pad);
	$len = length($len);
	if ($len > 0) {
            print $indent . ' 'x$pad . '<' . '-'x$len . '>' . "\n";
        } else {
            print $indent . ' 'x$pad . '#' . "\n";
        }
    }

    print <<'END';

DNA
END


sub help {
    print <<"EOM";
DNA Compiler    By S.N.M.
Version $id{rev}    Last Updated $id{date}

Syntax
    dnac
        --help
EOM
    exit;
}
