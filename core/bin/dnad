#!/usr/bin/perl

use strict;
use cmt::g;
use cmt::vcs;
use Getopt::Long;

    GetOptions(
        'help'      => sub { &help },
    );

    my $started = 0;
    my @bit2s;
    my $copynext = 0;

    while (<>) {
        if ($copynext == 1) {
            print;
            $copynext = 0;
            next;
        }

        if (m/<<DNA;/) {
            $started = 1;
            next;
        }
        next if (not $started);

        if (m/^DNA$/) {
            $started = 0;
            my @decoded_lines = DNA_decode join('', @bit2s);
            if ($decoded_lines[-1] =~ m/^\#\@DNA::(\w+)\s*(.*)$/) {
                my ($_cmd, $_arg) = ($1, $2);
                if ($_cmd eq 'COPY') {
                    $copynext = 1;
                }
            }
            @bit2s = ();
            print join("\n", @decoded_lines), "\n";
            next;
        }

        push @bit2s, $_;
    }


sub help {
    my %id = parse_id('$Id: dnad,v 1.6 2007-09-12 17:12:41 lenik Exp $');
    print <<"EOM";
DNA De-Compiler    By S.N.M.
Version 0.$id{rev}    Last Updated $id{date}

Syntax
    dnad
        --help
EOM
    exit;
}
