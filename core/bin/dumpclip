#!perl
# $Id: dumpclip,v 1.3 2006-11-17 20:28:08 lenik Exp $

use strict;
use Getopt::Long;
use Win32::Clipboard;


my $quiet_mode = 0;
my $get_format;
my $writeback = 0;

my %FORMAT_MAPS = (
	'text'		=> CF_TEXT,
	'dib'		=> CF_DIB,
	'hdrop'		=> CF_HDROP,
	'bitmap'	=> CF_BITMAP,
	'wmf'		=> CF_METAFILEPICT,
	'sylk'		=> CF_SYLK,
	'dif'		=> CF_DIF,
	'tiff'		=> CF_TIFF,
	'oemtext'	=> CF_OEMTEXT,
	'palette'	=> CF_PALETTE,
	'pendata'	=> CF_PENDATA,
	'riff'		=> CF_RIFF,
	'wave'		=> CF_WAVE,
	'unicode'	=> CF_UNICODETEXT,
	'emf'		=> CF_ENHMETAFILE,
	'locale'	=> CF_LOCALE,
	);

#my $filename;


sub init {
	GetOptions(
		'quiet'			=> \$quiet_mode,
		'format=s'		=> \$get_format,
		'writeback'		=> \$writeback,
		);

	if ($get_format) {
		my $mapped_format = $FORMAT_MAPS{$get_format};
		if (!$mapped_format) {
			die "Unknown format: $get_format";
		}
		$get_format = $mapped_format;
	} else {
		$get_format = CF_TEXT;
	}

#	$filename = shift @ARGV;
#	if (!$filename) {
#		die "No filename specified!";
#	}

#	if (!$quiet_mode) {
#		if (-f $filename) {
#			print "File $filename is already existed, overwrite? ";
#			my $answer = <STDIN>;
#			if ($answer !~ m/^y/i) {
#				return;
#			}
#		}
#	}
}


sub main {

	#open(FH, ">$filename") || die "Can't open file $filename for write: $!";

	binmode STDOUT;

	my $clip = Win32::Clipboard();
	my $text = $clip->GetAs($get_format);

	print $text;

	#print FH $text;
	#close FH;

}

&init;
&main;
1;
