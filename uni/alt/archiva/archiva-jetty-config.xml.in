<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN"
"http://jetty.mortbay.org/configure.dtd">

<Configure id="Server" class="org.mortbay.jetty.Server">

  <Call class="java.lang.System" name="setProperty">
    <Arg>derby.system.home</Arg>
    <Arg>@databasedir@</Arg>
  </Call>

  <Call class="java.lang.System" name="setProperty">
    <Arg>appserver.base</Arg>
    <Arg>@userdir@</Arg>
  </Call>

  <Call class="java.lang.System" name="setProperty">
    <Arg>appserver.home</Arg>
    <Arg>@userdir@</Arg>
  </Call>

  <New class="org.mortbay.jetty.plus.naming.Resource">
    <Arg>jdbc/users</Arg>
    <Arg>
      <New class="org.apache.derby.jdbc.EmbeddedDataSource">
        <Set name="DatabaseName">archiva-db</Set>
        <Set name="user">sa</Set>
        <Set name="createDatabase">create</Set>
      </New>
    </Arg>
  </New>

  <New class="org.mortbay.jetty.plus.naming.Resource">
    <Arg>jdbc/archiva</Arg>
    <Arg>
      <New class="org.apache.derby.jdbc.EmbeddedDataSource">
        <Set name="DatabaseName">archiva-db</Set>
        <Set name="user">sa</Set>
      </New>
    </Arg>
  </New>

  <New class="org.mortbay.jetty.plus.naming.Resource">
    <Arg>jdbc/shutdown</Arg>
    <Arg>
      <New class="org.apache.derby.jdbc.EmbeddedDataSource">
        <Set name="DatabaseName">archiva-db</Set>
        <Set name="user">sa</Set>
        <Set name="shutdownDatabase">shutdown</Set>
      </New>
    </Arg>
  </New>

  <New id="mail" class="org.mortbay.jetty.plus.naming.Resource">
    <Arg>mail/Session</Arg>
    <Arg>
      <New class="org.mortbay.naming.factories.MailSessionReference">
        <Set name="user">user@example.com</Set>
        <Set name="password">nothing</Set>
        <Set name="properties">
          <New class="java.util.Properties">
            <Put name="mail.smtp.host">smtp.gmail.com</Put>
            <Put name="mail.debug">true</Put>
          </New>
        </Set>
      </New>
    </Arg>
  </New>

  <New class="org.mortbay.jetty.webapp.WebAppContext">
    <Arg><Ref id="Contexts"/></Arg>
    <Arg>@wardir@/archiva.war</Arg>
    <Arg>/archiva</Arg>
    <Set name="overrideDescriptor">@jettyconfdir@/archiva-override-web.xml</Set>
    <Set name="configurationClasses"><Ref id="plusConfig"/></Set>
  </New>

</Configure>
