#!/bin/bash

# master-file

PACKAGE_NAME=${PWD##*/}

for envf in .env ../.env ../../.env; do
    if [ -f $envf ]; then
        . $envf
    fi
done

if [ -z "$EMAIL" ]; then
    # for future replacement.
    EMAIL=xjl-bug@99jsj.com
fi

function do_subst() {
    local template="$1"
    local output="$2"

    if [ -f "$output" ]; then
        echo "File $output is already existed, skipped. "
        return
    fi

    sed \
        -e "s,[@]NAME[@],$PACKAGE_NAME,g" \
        -e "s,[@]EMAIL[@],$EMAIL,g" \
        -e "s,[@]VERSION[@],0.1,g" \
        <$template >$output
}

do_subst "@pkgdatadir@/autoconf.template" configure.ac
do_subst "@pkgdatadir@/automake.template" Makefile.am

# ln -snf @pkgdatadir@/inc/...

touch NEWS README AUTHORS ChangeLog

# initialize VERSION.av
if VERINIT=`which verinit`; then
    $VERINIT
fi
