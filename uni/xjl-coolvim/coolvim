#!/bin/bash

# (the default dash also support ## substitution).
THIS=${0##*/}
if [ "$THIS" = "coolvims" ]; then
    SUDO=sudo
else
    SUDO=
fi

VIM=vim

if [ -z "$1" ]; then
    $VIM
    exit $?
fi

for f in "$@"; do

    sudo_r=
    sudo_w=
    new_file=

    if [ ! -f "$f" ]; then

        # find exec-PATH if file isn't exist.
        if which=`which "$f"`; then
            f="$which"

        # or create a new file, when necessary
        else
            new_file=1
        fi
    fi

    tabrc=
    if [ "$new_file" = 1 ]; then
        fdir=`dirname "$f"`
        if [ ! -w "$fdir" ]; then
            sudo_w=$SUDO
        fi
    else
        if [ ! -r "$f" ]; then sudo_r=$SUDO; fi
        if [ ! -w "$f" ]; then sudo_w=$SUDO; fi
        tabrc=`$sudo_r guesstab "$f"`
    fi

    $sudo_w $VIM -c "$tabrc" "$f"

done
