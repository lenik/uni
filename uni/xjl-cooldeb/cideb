#!/bin/bash

if [ ! -f VERSION.av ]; then
    echo "Not an autover dir. "
    exit 1
fi

if svn-isclean; then
    echo "already updated"
    exit 0
fi

vercomp -i commit >/dev/null
[ -f configure.ac ] && autover

if ! deb-redist -i; then
    echo debuild/redist failed.
    exit 1
fi

# don't update/commit in batch-mode.
if [ "$1" != "-b" ]; then
    sudo aptitude update
    # sudo apt-get update

    if ! sudo apt-get dist-upgrade --allow-unauthenticated; then
        echo "dist-upgrade failed, canceled. "
        exit 1
    fi

    SVN=`which svn`
    $SVN ci
fi

